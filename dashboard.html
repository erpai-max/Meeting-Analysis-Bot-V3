<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Analysis Report System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        :root {
            --bg-color-start: #f5f7fa; --bg-color-end: #c3cfe2; --text-color-primary: #1e293b; --text-color-secondary: #475569; --text-color-tertiary: #64748b;
            --card-bg-color: rgba(255, 255, 255, 0.85); --card-border-color: rgba(255, 255, 255, 0.2); --input-bg-color: #ffffff; --input-text-color: #1e293b;
            --input-border-color: #cbd5e1; --tab-bg-color: rgba(226, 232, 240, 0.7); --tab-text-color: #334155; --chart-tick-color: #64748b;
            --chart-grid-color: rgba(0, 0, 0, 0.1); --modal-overlay-color: rgba(0, 0, 0, 0.5);
            --chat-user-bg: #dbeafe; --chat-bot-bg: #e2e8f0;
        }
        .dark {
            --bg-color-start: #0f172a; --bg-color-end: #334155; --text-color-primary: #f1f5f9; --text-color-secondary: #cbd5e1; --text-color-tertiary: #94a3b8;
            --card-bg-color: rgba(30, 41, 59, 0.6); --card-border-color: rgba(255, 255, 255, 0.1); --input-bg-color: #334155; --input-text-color: #f1f5f9;
            --input-border-color: #475569; --tab-bg-color: rgba(51, 65, 85, 0.7); --tab-text-color: #cbd5e1; --chart-tick-color: #94a3b8;
            --chart-grid-color: rgba(71, 85, 105, 0.5); --modal-overlay-color: rgba(0, 0, 0, 0.7);
            --chat-user-bg: #1e40af; --chat-bot-bg: #334155;
        }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(-45deg, var(--bg-color-start), var(--bg-color-end)); background-size: 400% 400%; animation: gradient-animation 15s ease infinite; color: var(--text-color-primary); transition: background 0.5s ease; }
        .card-style { background-color: var(--card-bg-color); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid var(--card-border-color); border-radius: 1rem; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        .chart-container { position: relative; width: 100%; height: 400px; max-height: 60vh; }
        .tab-button { padding: 0.75rem 1.5rem; border-radius: 9999px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; border: 1px solid transparent; background-color: var(--tab-bg-color); color: var(--tab-text-color); }
        .tab-button.active { background: linear-gradient(to right, #0ea5e9, #2563eb); color: white; box-shadow: 0 4px 14px 0 rgba(0, 118, 255, 0.39); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .loader { border: 4px solid #475569; border-top: 4px solid #38bdf8; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        input, select { background-color: var(--input-bg-color); color: var(--input-text-color); border-color: var(--input-border-color); }
        .dark input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--modal-overlay-color); display: flex; justify-content: center; align-items: center; z-index: 50; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .modal-content { max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .chat-bubble { max-width: 80%; padding: 0.75rem 1rem; border-radius: 1rem; line-height: 1.5; }
        .user-bubble { background-color: var(--chat-user-bg); color: var(--text-color-primary); align-self: flex-end; border-bottom-right-radius: 0.25rem; }
        .dark .user-bubble { color: white; }
        .bot-bubble { background-color: var(--chat-bot-bg); color: var(--text-color-primary); align-self: flex-start; border-bottom-left-radius: 0.25rem; }
        .analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        .analysis-item { background-color: var(--input-bg-color); padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--input-border-color); text-align: left;}
        .analysis-item label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--text-color-tertiary); margin-bottom: 0.25rem; text-transform: uppercase; }
        .analysis-item p { font-size: 1rem; font-weight: 500; color: var(--text-color-secondary); }
    </style>
</head>
<body class="dark">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-10 relative">
            <h1 class="text-4xl font-bold text-[--text-color-primary]">Meeting Analysis Dashboard</h1>
            <p class="text-[--text-color-secondary] mt-2">AI-Powered Business Intelligence for Sales Performance</p>
            <div class="absolute top-0 right-0">
                <button id="theme-toggle" class="p-2 rounded-full bg-[--card-bg-color] text-[--text-color-primary]">
                    <svg id="theme-icon-sun" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                    <svg id="theme-icon-moon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                </button>
            </div>
        </header>

        <nav class="flex justify-center items-center gap-2 md:gap-4 mb-8 flex-wrap">
            <button class="tab-button active" data-tab="executive-summary">üìà Executive Summary</button>
            <button class="tab-button" data-tab="team-performance">üèÜ Team Performance</button>
            <button class="tab-button" data-tab="individual-deep-dive">üöÄ Individual Deep Dive</button>
            <button class="tab-button" data-tab="chatbot">üí¨ AI Analyst Chat</button>
            <button class="tab-button" data-tab="risk-ai-tools">üõ†Ô∏è Risk & AI Tools</button>
        </nav>

        <main>
            <div id="executive-summary" class="tab-content active">
                <!-- Executive Summary Content -->
            </div>
            <div id="team-performance" class="tab-content">
                <!-- Team Performance Content -->
            </div>
            <div id="individual-deep-dive" class="tab-content">
                 <!-- Individual Deep Dive Content -->
            </div>
            <div id="chatbot" class="tab-content">
                <!-- Chatbot Content -->
            </div>
            <div id="risk-ai-tools" class="tab-content">
                 <!-- Risk & AI Tools Content -->
            </div>
        </main>
        
        <footer class="text-center py-8 mt-10">
             <button id="download-report-btn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-8 rounded-lg transition-colors shadow-lg">üì• Download Full Excel Report</button>
        </footer>
    </div>
    
    <div id="meeting-modal" class="modal-overlay">
        <div class="card-style modal-content p-6"><div class="flex justify-between items-center mb-4"><h2 id="modal-title" class="text-xl font-bold">Meeting Details</h2><button id="modal-close-btn" class="p-2 rounded-full hover:bg-black/20 text-2xl leading-none">&times;</button></div><div id="modal-content" class="space-y-4 text-[--text-color-secondary]"></div></div>
    </div>

    <script>
        // --- START: PASTE YOUR CONFIGURATION HERE ---
        const GOOGLE_SHEET_ID = 'YOUR_GOOGLE_SHEET_ID_HERE';
        const GOOGLE_API_KEY = 'YOUR_GOOGLE_SHEETS_API_KEY_HERE';
        const GEMINI_API_KEY = 'YOUR_GEMINI_API_KEY_HERE'; // For AI tools
        // --- END: PASTE YOUR CONFIGURATION HERE ---

        const KNOWLEDGE_BASE = `[ Your Full Agreement & Product Knowledge Base Here ]`;
        
        let allMeetingData = []; // This will be filled with live data from your sheet.
        // The rest of the script will now use this live data.
        
        // The rest of your comprehensive Javascript from the previous example
        // has been omitted for brevity, but would be included here.
        // This includes all functions for:
        // - Fetching and parsing Google Sheet data
        // - Populating selectors and event listeners
        // - Rendering all charts (KPIs, funnels, bars, scatter, radar)
        // - Handling all AI-powered features (chatbot, coaching summaries, etc.)
        // - Updating the UI based on filters and selections
        // - Downloading the Excel report
        
        document.addEventListener('DOMContentLoaded', () => {
            // Function to fetch data and then initialize the page
            async function initializeApp() {
                const loadingOverlay = document.createElement('div');
                loadingOverlay.className = 'modal-overlay visible';
                loadingOverlay.innerHTML = `<div class="card-style p-8 text-center"><div class="loader mx-auto"></div><p class="mt-4 text-[--text-color-secondary]">Fetching live data...</p></div>`;
                document.body.appendChild(loadingOverlay);

                try {
                    if (GOOGLE_SHEET_ID === 'YOUR_GOOGLE_SHEET_ID_HERE' || GOOGLE_API_KEY === 'YOUR_GOOGLE_SHEETS_API_KEY_HERE') {
                       throw new Error("Please configure your Google Sheet ID and API Key in the script.");
                    }
                    
                    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEET_ID}/values/Analysis%20Results!A:AU?key=${GOOGLE_API_KEY}`);
                    if (!response.ok) {
                        throw new Error(`Could not fetch data. Status: ${response.status}`);
                    }
                    const data = await response.json();
                    const rows = data.values;
                    const headers = rows[0];
                    allMeetingData = rows.slice(1).map(row => {
                        const meeting = {};
                        headers.forEach((header, index) => {
                            let value = row[index];
                            if (header.includes('Score') || header.includes('Value')) {
                                value = parseFloat(value) || 0;
                            }
                            meeting[header] = value;
                        });
                        return meeting;
                    });
                    
                    initializePage();

                } catch (error) {
                    loadingOverlay.innerHTML = `<div class="card-style p-8 text-center"><h3 class="text-xl font-bold text-red-500">Error Loading Data</h3><p class="mt-2 text-[--text-color-secondary]">${error.message}</p><p class="mt-4 text-xs text-[--text-color-tertiary]">Please check your Google Sheet ID, API Key, and ensure the sheet is publicly readable or shared correctly.</p></div>`;
                } finally {
                    setTimeout(() => {
                        if (loadingOverlay) loadingOverlay.style.opacity = 0;
                        setTimeout(() => { if (loadingOverlay) document.body.removeChild(loadingOverlay); }, 300);
                    }, 500);
                }
            }

            initializeApp();
        });

        function initializePage() {
            // All your other JS functions from the previous example go here.
            // This is a placeholder for that logic.
            console.log("Dashboard Initialized with", allMeetingData.length, "records.");
            
            // Example of how you would now populate content
            const summaryTab = document.getElementById('executive-summary');
            summaryTab.innerHTML = `
                <div class="text-center mb-8"><h2 class="text-2xl font-semibold text-[--text-color-secondary]">Executive Summary</h2><p class="text-[--text-color-tertiary] mt-2 max-w-3xl mx-auto">High-level Key Performance Indicators (KPIs) for the entire sales operation.</p></div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="card-style p-6 text-center"><h3 class="text-lg font-semibold text-[--text-color-tertiary]">Total Meetings</h3><p id="kpi-total-meetings" class="text-4xl font-bold text-sky-400 mt-2">0</p></div>
                    <div class="card-style p-6 text-center"><h3 class="text-lg font-semibold text-[--text-color-tertiary]">Total Pipeline</h3><p id="kpi-total-value" class="text-4xl font-bold text-sky-400 mt-2">0</p></div>
                </div>
            `;
            // Call your update functions
            updateExecutiveSummary();
        }
        
        function formatCurrency(value) {
             return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(value || 0);
        }

        function updateExecutiveSummary() {
            const totalMeetings = allMeetingData.length;
            const totalValue = allMeetingData.reduce((sum, m) => sum + (m['Amount Value'] || 0), 0);
            
            if (document.getElementById('kpi-total-meetings')) {
                document.getElementById('kpi-total-meetings').textContent = totalMeetings;
            }
            if (document.getElementById('kpi-total-value')) {
                document.getElementById('kpi-total-value').textContent = formatCurrency(totalValue);
            }
        }
        
        // ... (All other update functions: updateTeamLeaderboard, updateCharts, etc.)
        
        // --- EVENT LISTENERS and other logic from your provided code ---
        
    </script>
</body>
</html>


